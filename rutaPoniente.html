<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Recorrido en Coche - Campeche</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
body {
margin: 0;
font-family: 'Segoe UI', sans-serif;
background-color: #f8f8f8;
}
header {
background-color: #702c37;
color: #b38b28;
padding: 20px;
text-align: center;
position: relative;
}
.logo {
position: absolute;
top: 35px;
left: 10px;
height: 50px;
width: auto;
transition: all 0.3s ease;
}
@media screen and (max-width: 768px) {
.logo {
height: 40px;
top: 5px;
left: 5px;
}
header h1 {
font-size: 1.5em;
padding: 10px 0;
}
}
.container {
display: flex;
position: relative;
height: 500px;
width: 90%;
max-width: 1200px;
margin: 20px auto;
border-radius: 15px;
box-shadow: 0 0 15px #00000022;
overflow: hidden;
}
#map {
flex: 1;
height: 100%;
z-index: 1;
}
/* Panel lateral */
#sidebar {
position: absolute;
top: 0;
right: -400px;
width: 400px;
height: 100%;
background: white;
box-shadow: -4px 0 20px rgba(0,0,0,0.15);
transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
z-index: 1000;
overflow-y: auto;
border-left: 3px solid #8B0000;
}
#sidebar.active {
right: 0;
}
.sidebar-header {
display: flex;
justify-content: space-between;
align-items: flex-start;
padding: 20px;
border-bottom: 2px solid #e5e7eb;
background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
position: sticky;
top: 0;
z-index: 10;
}
.header-content {
flex: 1;
}
.sidebar-header h2 {
color: #8B0000;
font-size: 1.4rem;
margin: 0 0 8px 0;
font-weight: 700;
line-height: 1.3;
}
.distance-info {
display: flex;
align-items: center;
gap: 8px;
margin-top: 8px;
}
.distance-label {
font-size: 14px;
color: #6b7280;
font-weight: 500;
}
.distance-value {
font-size: 14px;
color: #059669;
font-weight: 600;
background: #d1fae5;
padding: 2px 8px;
border-radius: 12px;
}
.close-btn {
background: #8B0000;
color: white;
border: none;
padding: 8px 12px;
border-radius: 8px;
cursor: pointer;
font-size: 14px;
font-weight: 600;
transition: all 0.3s ease;
margin-left: 15px;
}
.close-btn:hover {
background: #a30000;
}
/* Carrusel de im√°genes */
.image-carousel {
padding: 20px;
}
.carousel-container {
position: relative;
background: #f8fafc;
border-radius: 12px;
overflow: hidden;
box-shadow: 0 4px 12px rgba(0,0,0,0.1);
border: 1px solid #e5e7eb;
}
.carousel-images {
position: relative;
height: 250px;
overflow: hidden;
}
.carousel-image {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
object-fit: cover;
opacity: 0;
transition: opacity 0.6s ease-in-out;
border-radius: 12px 12px 0 0;
}
.carousel-image.active {
opacity: 1;
}
.carousel-controls {
display: flex;
justify-content: space-between;
align-items: center;
padding: 15px;
background: white;
}
.carousel-btn {
background: #8B0000;
color: white;
border: none;
padding: 8px 12px;
border-radius: 8px;
cursor: pointer;
font-size: 12px;
font-weight: 600;
transition: all 0.3s ease;
}
.carousel-btn:hover {
background: #a30000;
}
.carousel-indicators {
display: flex;
gap: 8px;
align-items: center;
}
.indicator {
width: 10px;
height: 10px;
border-radius: 50%;
background: #d1d5db;
cursor: pointer;
transition: all 0.3s ease;
}
.indicator.active {
background: #8B0000;
transform: scale(1.2);
}
.carousel-progress {
height: 3px;
background: #e5e7eb;
position: relative;
overflow: hidden;
}
.progress-bar {
height: 100%;
background: #8B0000;
width: 0%;
transition: none;
}
/* Descripci√≥n del sitio */
.site-description {
padding: 0 20px 20px;
}
.site-description p {
line-height: 1.6;
color: #374151;
margin-bottom: 15px;
text-align: justify;
font-size: 14px;
background: #f9fafb;
padding: 15px;
border-radius: 10px;
border-left: 4px solid #8B0000;
}
.action-buttons {
display: flex;
gap: 10px;
flex-direction: column;
}
.speak-btn, .center-btn, .route-btn {
background: #8B0000;
color: white;
border: none;
padding: 10px 15px;
border-radius: 8px;
cursor: pointer;
font-size: 14px;
font-weight: 600;
transition: all 0.3s ease;
display: flex;
align-items: center;
justify-content: center;
gap: 8px;
}
#pauseBtn {
  background: #6b7280; /* gris oscuro */
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  transition: all 0.3s ease;
  display: none; /* para ocultarlo por defecto */
}

#pauseBtn:hover {
  background: #4b5563;
}

.speak-btn:hover, .center-btn:hover, .route-btn:hover {
background: #a30000;
}
.speak-btn:disabled {
background: #9ca3af;
cursor: not-allowed;
}
/* Bot√≥n especial para crear ruta en sidebar */
.route-btn {
background: linear-gradient(135deg, #059669 0%, #047857 100%);
}
.route-btn:hover {
background: linear-gradient(135deg, #047857 0%, #065f46 100%);
}
#distance,
#description {
text-align: center;
margin-top: 10px;
font-size: 1.2em;
font-weight: bold;
}
#description {
padding: 10px;
margin-bottom: 10px;
}
.btn-red-vino {
background-color: #8B0000;
color: #fff;
border: none;
cursor: pointer;
transition: background 0.3s;
padding: 6px 12px;
border-radius: 8px;
margin: 2px;
}
.btn-red-vino:hover {
background-color: #a30000;
}
/* Bot√≥n cancelar ruta */
.btn-cancel {
background-color: #dc3545;
color: #fff;
border: none;
cursor: pointer;
transition: background 0.3s;
padding: 6px 12px;
border-radius: 8px;
margin: 2px;
}
.btn-cancel:hover {
background-color: #c82333;
}
/* Contenedor de botones de control */
.route-controls {
text-align: center;
margin-top: 10px;
display: flex;
justify-content: center;
gap: 10px;
flex-wrap: wrap;
}
/* Estado de ruta activa */
.route-status {
background: #d1fae5;
color: #065f46;
padding: 8px 15px;
border-radius: 8px;
margin: 10px auto;
display: none;
max-width: 300px;
text-align: center;
font-weight: 600;
border: 1px solid #10b981;
}
.route-status.active {
display: block;
}
/* Informaci√≥n del recorrido */
.tour-info {
background: #e0f2fe;
color: #0277bd;
padding: 10px 15px;
border-radius: 8px;
margin: 10px auto;
max-width: 400px;
text-align: center;
font-size: 14px;
border: 1px solid #29b6f6;
}
/* Bot√≥n ir al recorrido en popup */
.popup-route-btn {
background: linear-gradient(135deg, #059669 0%, #047857 100%);
color: white;
border: none;
padding: 8px 16px;
border-radius: 6px;
cursor: pointer;
font-size: 12px;
font-weight: 600;
margin-top: 8px;
width: 100%;
transition: all 0.3s ease;
box-shadow: 0 2px 4px rgba(5, 150, 105, 0.2);
}
.popup-route-btn:hover {
background: linear-gradient(135deg, #047857 0%, #065f46 100%);
transform: translateY(-1px);
box-shadow: 0 4px 8px rgba(5, 150, 105, 0.3);
}
.lang-switch {
position: absolute;
top: 10px;
right: 10px;
}
img {
max-width: 100%;
height: auto;
border-radius: 10px;
margin-bottom: 10px;
}
.popup-btn {
display: inline-block;
margin-top: 10px;
width: 100%;
text-align: center;
}
.btn-back {
background-color: #8B0000;
color: #fff;
padding: 10px 20px;
border: none;
border-radius: 8px;
font-size: 1.2em;
cursor: pointer;
margin-top: 20px;
margin-bottom: 40px;
transition: background-color 0.3s;
}
.btn-back:hover {
background-color: #a30000;
}
/* Popup simplificado */
.simple-popup {
text-align: center;
padding: 10px;
max-width: 200px;
}
.simple-popup h3 {
margin: 0 0 10px 0;
font-size: 16px;
font-weight: bold;
color: #8B0000;
}
.simple-popup img {
width: 100%;
height: 120px;
object-fit: cover;
border-radius: 8px;
margin: 0;
}
/* Responsive */
@media (max-width: 768px) {
#sidebar {
width: 100%;
right: -100%;
}
.carousel-images {
height: 200px;
}
.sidebar-header {
padding: 15px;
}
.sidebar-header h2 {
font-size: 1.2rem;
}
.image-carousel {
padding: 15px;
}
.site-description {
padding: 0 15px 15px;
}
.route-controls {
flex-direction: column;
align-items: center;
}
.popup-route-btn {
font-size: 11px;
padding: 6px 12px;
}
}
/* Scrollbar personalizado */
#sidebar::-webkit-scrollbar {
width: 6px;
}
#sidebar::-webkit-scrollbar-track {
background: #f1f5f9;
}
#sidebar::-webkit-scrollbar-thumb {
background: #cbd5e1;
border-radius: 3px;
}
#sidebar::-webkit-scrollbar-thumb:hover {
background: #94a3b8;
}
</style>
</head>
<body>
<header>
<img src="img/LogoINAH_Dorado.png" alt="Logo" class="logo">
<h1>Patrimonio Cultural Subacuatico Poniente</h1>
<div class="lang-switch">
<button id="btnEs" class="btn-red-vino">üá≤üáΩ Espa√±ol</button>
<button id="btnEn" class="btn-red-vino">üá∫üá∏ English</button>
</div>
</header>
<div id="description">
<p>Bienvenido al recorrido en coche por la ciudad de Campeche. Explora lugares hist√≥ricos y hermosos paisajes. Recorrer√°s sitios emblem√°ticos de la ciudad y conocer√°s su rica historia. Aseg√∫rate de disfrutar cada momento mientras avanzas en el recorrido. ¬°Comencemos!</p>
</div>
<div id="siteMenu" style="text-align: center; margin: 20px;">
<h2>üìç Sitios del Recorrido</h2>
<div id="siteButtons" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;"></div>
</div>

<div id="distance">Distancia al destino: -</div>

<!-- Informaci√≥n del recorrido -->
<div id="tourInfo" class="tour-info">
<span id="tourInfoText">üí° Haz clic en los iconos del mapa para crear rutas, o usa los botones de abajo para ver el recorrido completo</span>
</div>

<!-- Estado de ruta activa -->
<div id="routeStatus" class="route-status">
<span id="routeStatusText">Ruta activa a: </span>
</div>

<!-- Controles de ruta -->
<div class="route-controls">
<button id="startRouteBtn" class="btn-red-vino">üó∫Ô∏è Ver Recorrido Completo</button>
<button id="startTourBtn" class="btn-red-vino">üöó Ir al Primer Sitio</button>
<button id="cancelRouteBtn" class="btn-cancel" style="display: none;">‚ùå Cancelar Ruta</button>
<button id="clearAllRoutesBtn" class="btn-cancel" style="display: none;">üóëÔ∏è Limpiar Todo</button>
</div>

<div class="container" id="mapContainer">
<div id="map"></div>
<!-- Panel lateral -->
<div id="sidebar">
<div id="sidebar-content">
<!-- El contenido se genera din√°micamente -->
</div>
</div>
</div>
<div style="text-align: center;">
<a href="index.html">
<button class="btn-back">Regresar al Inicio</button>
</a>
</div>

<footer style="background-color:#702c37; color:#b38b28; text-align:center; padding:30px 10px; font-family: 'Arial', sans-serif;">
  <div style="margin-bottom: 20px;">
    <!-- Logo -->
    <img src="img/LogoINAH_Dorado2.png" alt="Logo" style="width:90px; margin-bottom:10px;">
  </div>

  <nav style="margin-bottom: 20px;">
    <a href="index.html" style="color:#b38b28; margin: 0 12px; text-decoration:none;">Inicio</a>
      <a href="acercaDe.html" style="color:#b38b28; margin: 0 12px; text-decoration:none;">Acerca De</a>
    <a href="https://www.google.com/maps?q=19.843044,-90.538832" target="_blank" style="color:#b38b28; margin: 0 12px; text-decoration:none;">
      Direcci√≥n
    </a>
    <a href="tel:+529818115510" style="color:#b38b28; margin: 0 12px; text-decoration:none;">
      Contacto
    </a>
  </nav>

  <div style="margin-bottom: 25px;">
    <!-- Redes sociales -->
    <a href="https://www.facebook.com/share/19GQgXUWKJ/?mibextid=wwXIfr" target="_blank" style="color:#b38b28; margin: 0 8px; font-size: 18px; text-decoration:none;">
      <i class="fab fa-facebook-f"></i> 
    </a>
    <a href="https://www.instagram.com/inahsasyuc?igsh=MTczMDg1NGxmYzRyNw==" target="_blank" style="color:#b38b28; margin: 0 8px; font-size: 18px; text-decoration:none;">
      <i class="fab fa-instagram"></i> 
    </a>
    <a href="https://x.com/inahsas_yuc" target="_blank" style="color:#b38b28; margin: 0 8px; font-size: 18px; text-decoration:none;">
      <i class="fab fa-twitter"></i> 
    </a>
    <a href="https://youtube.com/@inahtv?si=dTPfND_makjeZTEm" target="_blank" style="color:#b38b28; margin: 0 8px; font-size: 18px; text-decoration:none;">
      <i class="fab fa-youtube"></i> 
    </a>
  </div>

  <hr style="border-color: #8c5d54; margin-bottom: 15px;">

  <p style="font-size: 14px; margin: 0;">¬© 2025 Miguiaa_mx. Todos los derechos reservados.</p>
  <p style="font-weight: 600; font-size: 14px; margin: 5px 0 0 0;">DISE√ëADO POR INAH CAMPECHE</p>
</footer>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// Variables globales
let map;
let userMarker;
let followUser = true;
let currentCarouselIndex = 0;
let carouselInterval;
let blueRouteLine;
let selectedRouteLine;
let selectedSite = null;
let routeToStartLine;
let distanceInterval;
let activeRouteType = null; // 'selected', 'start', 'complete'

// Funci√≥n para detectar si es dispositivo m√≥vil
function isMobileDevice() {
return window.innerWidth <= 768;
}

// Funci√≥n para hacer scroll suave hacia el contenedor del mapa en m√≥viles
function scrollToMapOnMobile() {
if (isMobileDevice()) {
const mapContainer = document.getElementById('mapContainer');
if (mapContainer) {
// Peque√±o delay para que la animaci√≥n del sidebar se complete
setTimeout(() => {
mapContainer.scrollIntoView({
behavior: 'smooth',
block: 'start'
});
}, 200);
}
}
}

// Inicializar mapa
const mapInstance = L.map('map').setView([19.845, -90.523], 12);
map = mapInstance;
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);
// Desactiva el seguimiento si el usuario empieza a mover el mapa manualmente
map.on('movestart', () => {
followUser = false;
});

const translations = {
es: {
welcome: 'Bienvenido al recorrido en auto por la ciudad de Campeche. Explora lugares hist√≥ricos y paisajes hermosos. Visitar√°s sitios emblem√°ticos de la ciudad y conocer√°s su rica historia. Aseg√∫rate de disfrutar cada momento mientras avanzas en el recorrido. ¬°Comencemos!',
distance: 'Distancia al destino',
closeSidebar: 'Cerrar',
prevImage: 'Anterior',
nextImage: 'Siguiente',
listenDescription: 'Escuchar descripci√≥n',
centerMap: 'Centrar en mapa',
createRoute: 'Crear Ruta a Este Sitio',
meters: 'metros',
kilometers: 'kil√≥metros',
viewCompleteRoute: 'üó∫Ô∏è Ver Recorrido Completo',
goToFirstSite: 'üöó Ir al Primer Sitio',
cancelRoute: '‚ùå Cancelar Ruta',
clearAll: 'üóëÔ∏è Limpiar Todo',
routeActive: 'Ruta activa a: ',
routeToStart: 'Ruta al sitio m√°s cercano',
routeCanceled: 'Ruta cancelada',
allRoutesCleared: 'Todas las rutas eliminadas',
tourInfoDefault: 'üí° Haz clic en los iconos del mapa para crear rutas, o usa los botones de abajo para ver el recorrido completo',
tourInfoComplete: 'üó∫Ô∏è Mostrando recorrido completo entre todos los sitios',
tourInfoToSite: 'üöó Ruta creada desde tu ubicaci√≥n hasta el sitio m√°s cercano',
goToRoute: 'üöó Ir al Recorrido',
routeCreated: 'Ruta creada hacia',
locationNotAvailable: 'Ubicaci√≥n no disponible',
'Barrio de San Rom√°n': {
description: 'Bienvenido, te encuentras en el barrio de San Rom√°n de la ciudad de San Francisco de Campeche, fundado en el siglo XVI. Este barrio es conocido por su iglesia, que alberga una imagen del Cristo Negro, tra√≠da de Veracruz en 1565 y considerada un milagro divino por su portentosa llegada. El barrio de San Rom√°n fue habitado por marinos, constructores navales y calafateros al estar cerca de los astilleros donde se construyeron nav√≠os para la defensa y el comercio en Am√©rica. Fue nombrado el primer Barrio M√°gico de Campeche en 2024.',
images: ['imgPoniente/sanRoman1.jpg', 'imgPoniente/sanRoman2.jpg', 'imgPoniente/sanRoman3.jpg']
},
'Atarazanas Playa San Rom√°n': {
description: 'Las Atarazanas o astilleros fueron las instalaciones donde se constru√≠an y reparaban embarcaciones de madera y vela. El primer astillero en el puerto de campeche existi√≥ desde 1650 en la playa frente al templo de San Jos√© y fue destruido por un incendio en 1672 por el pirata ‚ÄúLorencillo‚Äù. Al construirse el baluarte de San Carlos la construcci√≥n naval se reubic√≥ hacia la playa del barrio de San Rom√°n. ¬øSab√≠as que el corsario espa√±ol Amaro Felipe Rodr√≠guez conocido como ‚ÄúAmaro Pargo‚Äù construy√≥ entre 1720 y 1721 en este astillero el nav√≠o ‚ÄúLas Potencias del Santo Cristo de San Rom√°n‚Äù de 571 toneladas? En la actualidad, el √°rea es conocida como el Muelle de los Pescadores de San Rom√°n, un sitio emblem√°tico donde se mezclan la historia y la vida cotidiana de los pescadores locales. El muelle conserva su importancia como punto de encuentro comunitario y es un atractivo tur√≠stico que refleja el legado mar√≠timo de Campeche. ',
images: ['imgPoniente/atarazanas1.jpg', 'imgPoniente/atarazanas1.png']
},
'Novia del Mar': {
description: 'Cuenta la leyenda que hace muchos a√±os hab√≠a una hermosa mujer que viv√≠a en el puerto de Campeche. Ella sol√≠a pasear por la costa para contemplar las enormes embarcaciones provenientes de diversas partes del mundo. Le gustaba imaginar c√≥mo eran aquellos pa√≠ses desde donde ven√≠an tan ex√≥ticas y variadas mercanc√≠as. La belleza de aquella joven era tal que hasta el mar qued√≥ cautivado y deseaba tener su atenci√≥n por siempre. Por ello, procuraba robarle sonrisas con suaves y armoniosos oleajes que reflejaban los destellos dorados del sol. Por las tardes, el mar se pintaba de naranja mientras el astro rey se hund√≠a en sus aguas. Aquel era espect√°culo que estremec√≠a de emoci√≥n a la doncella. Un d√≠a, durante uno de sus paseos por el puerto, la joven conoci√≥ a un marinero de quien qued√≥ perdidamente enamorada. Era tan fuerte el sentimiento de ambos que el mar se puso celoso de aquel aut√©ntico cari√±o. Transcurrieron un par de semanas. El amor entre la campechana y el marinero creci√≥. El mar se sent√≠a olvidado al ya no sentir la suave caricia de los dedos de la mujer durante los atardeceres: ya no hab√≠a m√°s sonrisas para √©l. De pronto, el marinero tuvo que zarpar de Campeche junto a su tripulaci√≥n, pero prometi√≥ volver cuanto antes para estrechar al amor entre sus brazos nuevamente. Aquel beso que se dieron para despedirse, ser√≠a el √∫ltimo. La envidia del mar se transform√≥ en ira y, al ver la oportunidad de quedarse de nueva cuenta con la mujer para √©l, de la nada cre√≥ una enorme tormenta, con furiosas olas que terminaron por sepultar la embarcaci√≥n donde viajaba el marinero. De sus tripulantes no se supo algo jam√°s. Desde entonces, cada tarde aquella hermosa mujer llega hasta a la orilla de la playa para esperar el regreso de su amado. Siempre la ver√°n sentada a la orilla del malec√≥n de Campeche, con la vista fija en el mar, que se regocija con su belleza. ',
images: ['imgPoniente/noviaMar1.jpg', 'imgPoniente/noviaMar2.jpg']
},
'Iglesia de Guadalupe': {
description: 'El Barrio de Guadalupe es uno de los cinco barrios tradicionales de San Francisco de Campeche, junto con San Rom√°n, Santa Ana, San Francisco y Santa Luc√≠a. Su origen se remonta al siglo XVI, cuando en 1575 se financi√≥ la construcci√≥n de una ermita dedicada a la Virgen de Guadalupe en una zona entonces despoblada. Con el tiempo, esta √°rea se transform√≥ en un barrio habitado principalmente por comerciantes, caracterizado por sus grandes casas y familias de alto nivel econ√≥mico. El parque tiene un quiosco central y es un lugar de encuentro para la comunidad. El templo tiene una fachada sencilla y en su torre alberga la campana del barco de vapor RMS Tweed que naufrag√≥ en el arrecife Alacranes Golfo de M√©xico en 1847.',
images: ['imgPoniente/guadalupe1.jpg', 'imgPoniente/guadalupe2.jpg']
},
'Edificio INAH Arquiologia Subacuatica': {
description: 'La arqueolog√≠a subacu√°tica es la disciplina del estudio de los vestigios culturales que yacen sumergidos en los cuerpos de agua, relacionados con actividades de las sociedades pasadas como la navegaci√≥n, el comercio, la guerra, cosmovisiones, etc. En M√©xico, el Instituto Nacional de Antropolog√≠a e Historia (INAH) a trav√©s de la Subdirecci√≥n de Arqueolog√≠a Subacu√°tica se encarga de estudiar, proteger y conservar este patrimonio. En la ciudad de San Francisco de Campeche el INAH cuenta con una sede en donde diferentes especialistas en arqueolog√≠a, historia, arquitectura, restauraci√≥n y conservaci√≥n. En este edificio marcado con el n√∫mero 223 puedes observar antiguas anclas, ca√±ones, vasijas, entre otros en proceso de estudio y conservaci√≥n. ',
images: ['imgPoniente/edificio1.jpg', 'imgPoniente/edificio2.jpg']
},
'Iglesia de San Francisco': {
description: 'El Barrio de San Francisco es uno de los m√°s antiguos y emblem√°ticos de la ciudad de San Francisco de Campeche, con una historia que se remonta a la √©poca prehisp√°nica. Originalmente, fue un asentamiento maya conocido como Ah Kin Pech, que m√°s tarde se integr√≥ a la villa fundada por los espa√±oles en 1540. Durante el virreinato, el barrio se desarroll√≥ como una zona extramuros, es decir, fuera del per√≠metro amurallado de la ciudad. Esta ubicaci√≥n permiti√≥ que conservara una traza urbana irregular, con calles y callejones bordeados por altas casonas coloniales, reflejo de su origen maya y su evoluci√≥n durante la colonia. Entre los elementos destacados del barrio se encuentra la iglesia de San Francisco y los restos del convento que fue un importante centro de evangelizaci√≥n durante la √©poca virreinal. En 1653 el nav√≠o en donde viajaba don Mart√≠n Cort√©s, hijo del conquistador Hern√°n Cort√©s, y su esposa lleg√≥ a Campeche desviado por una tormenta, aloj√°ndose en el convento de San Francisco. Su esposa dio a luz a su primer hijo que fue bautizado en la iglesia. Puedes visitar el interior y observar la pila bautismal que recuerda este acontecimiento. ',
images: ['imgPoniente/sanFrancisco1.jpg', 'imgPoniente/sanFrancisco2.jpg', 'imgPoniente/sanFrancisco3.jpg']
},
'Bateria de San Matias': {
description: 'Se encuentra en la desembocadura de la antigua r√≠a de San Francisco, cerca del barrio del mismo nombre. Fue construida en el siglo XVIII como parte de un sistema de defensa para la costa y los reductos de San Miguel y San Jos√© el Alto del puerto de San Francisco de Campeche, entre las que se encontraban tambi√©n las bater√≠as de San Luis y San Lucas. La finalidad de la bater√≠a de San Mat√≠as era la de retener alg√∫n desembarco por la playa de San Francisco y evitar que el enemigo tuviera acceso al Reducto de San Jos√© el Alto.',
images: ['imgPoniente/sanMatias1.jpg', 'imgPoniente/sanMatias2.jpg']
},
'Bateria de San Lucas': {
description: 'Su funci√≥n era la de apoyar junto a la bater√≠a de San Mat√≠as la defensa del Reducto de San Jos√© el Alto, evitando posibles desembarcos hacia la costa de barlovento Fue dise√±a por el ingeniero militar Agust√≠n Crame de forma semicircular e irregular, con una explanada que ten√≠a capacidad para 8 ca√±ones, una rampa adosada al centro y dos cuartos. Su construcci√≥n dur√≥ 6 meses y se concluy√≥ en 1792. En per√≠odos de marea alta sol√≠a quedar rodeada por el mar.',
images: ['imgPoniente/sanLucas1.jpg', 'imgPoniente/sanLucas2.jpg', 'imgPoniente/sanLucas3.jpg']
}
},
'en': {
welcome: 'Welcome to the car tour through the city of Campeche. Explore historical places and beautiful landscapes. You will visit emblematic sites of the city and learn about its rich history. Be sure to enjoy every moment as you progress through the tour. Let\'s get started!',
distance: 'Distance to destination',
closeSidebar: 'Close',
prevImage: 'Previous',
nextImage: 'Next',
listenDescription: 'Listen to description',
centerMap: 'Center on map',
createRoute: 'Create Route to This Site',
meters: 'meters',
kilometers: 'kilometers',
viewCompleteRoute: 'üó∫Ô∏è View Complete Route',
goToFirstSite: 'üöó Go to First Site',
cancelRoute: '‚ùå Cancel Route',
clearAll: 'üóëÔ∏è Clear All',
routeActive: 'Active route to: ',
routeToStart: 'Route to nearest site',
routeCanceled: 'Route canceled',
allRoutesCleared: 'All routes cleared',
tourInfoDefault: 'üí° Click on map icons to create routes, or use the buttons below to view the complete tour',
tourInfoComplete: 'üó∫Ô∏è Showing complete route between all sites',
tourInfoToSite: 'üöó Route created from your location to the nearest site',
goToRoute: 'üöó Go to Route',
routeCreated: 'Route created to',
locationNotAvailable: 'Location not available',
'Barrio de San Rom√°n': {
description: 'Welcome, you are in the San Rom√°n neighborhood of the city of San Francisco de Campeche, founded in the 16th century. This neighborhood is known for its church, which houses an image of the Black Christ, brought from Veracruz in 1565 and considered a divine miracle due to its portentous arrival. The San Rom√°n neighborhood was inhabited by sailors, shipbuilders, and caulkers as it was close to the shipyards where ships were built for defense and trade in the Americas. It was named Campeche\'s first Magical Neighborhood in 2024.',
images: ['imgPoniente/sanRoman1.jpg', 'imgPoniente/sanRoman2.jpg', 'imgPoniente/sanRoman3.jpg']
},
'Atarazanas Playa San Rom√°n': {
description: 'The Atarazanas, or shipyards, were the facilities where wooden and sailing vessels were built and repaired. The first shipyard in the port of Campeche existed since 1650 on the beach in front of the San Jos√© temple and was destroyed by fire in 1672 by the pirate "Lorencillo." When the San Carlos bastion was built, shipbuilding was relocated to the beach in the San Rom√°n neighborhood. Did you know that the Spanish privateer Amaro Felipe Rodr√≠guez, known as "Amaro Pargo," built the 571-ton ship "Las Potencias del Santo Cristo de San Rom√°n" in this shipyard between 1720 and 1721? Today, the area is known as the San Rom√°n Fishermen\'s Wharf, an emblematic site where history and the daily life of local fishermen blend. The wharf retains its importance as a community meeting point and is a tourist attraction that reflects Campeche\'s maritime heritage.',
images: ['imgPoniente/atarazanas1.jpg', 'imgPoniente/atarazanas1.png']
},
'Novia del Mar': {
description: 'Legend has it that many years ago, there was a beautiful woman who lived in the port of Campeche. She used to stroll along the coast to admire the enormous ships arriving from different parts of the world. She enjoyed imagining what those countries were like, the ones where such exotic and varied goods came from. The young woman\‚Äôs beauty was so captivating that even the sea fell in love with her and longed for her attention forever. To win her over, it tried to steal her smiles with gentle and harmonious waves that reflected the golden glimmers of the sun. In the afternoons, the sea would turn orange as the sun sank into its waters. That spectacle stirred deep emotions in the maiden. One day, during one of her walks along the port, the young woman met a sailor with whom she fell hopelessly in love.Their feelings were so strong and true that the sea grew jealous of their love.A couple of weeks went by. The love between the woman from Campeche and the sailor blossomed. The sea felt forgotten, no longer touched by the woman\‚Äôs gentle fingers during sunset‚Äîthere were no more smiles for it. Suddenly, the sailor had to set sail from Campeche with his crew, but he promised to return soon to hold his love in his arms once again. That farewell kiss would be their last.The sea\‚Äôs envy turned into rage, and seeing a chance to have the woman for itself once more, it suddenly unleashed a massive storm. Furious waves swallowed the ship carrying the sailor, and none of its crew was ever seen again. Since then, every afternoon, the beautiful woman comes to the shore to wait for her beloved\'s return.She is always seen sitting at the edge of the Campeche boardwalk, her gaze fixed on the sea-a sea that rejoices in her beauty.',
images: ['imgPoniente/noviaMar1.jpg', 'imgPoniente/noviaMar2.jpg']
},
'Iglesia de Guadalupe': {
description: 'A natural park with panoramic views of the city. It offers green areas, rest zones, and walking trails ideal for spending time with family or friendsThe Guadalupe neighborhood is one of the five traditional neighborhoods of San Francisco de Campeche, along with San Rom√°n, Santa Ana, San Francisco, and Santa Luc√≠a. Its origins date back to the 16th century, when in 1575 the construction of a chapel dedicated to the Virgin of Guadalupe was funded in a then-unpopulated area. Over time, this area transformed into a neighborhood inhabited primarily by merchants, characterized by its large houses and wealthy families. The park has a central kiosk and is a meeting place for the community. The temple has a simple fa√ßade and its tower houses the bell of the steamship RMS Tweed, which sank on the Alacranes Reef in the Gulf of Mexico in 1847.',
images: ['imgPoniente/guadalupe1.jpg', 'imgPoniente/guadalupe2.jpg']
},
'Edificio INAH Arquiologia Subacuatica': {
description: 'Underwater archaeology is the study of cultural remains found submerged in bodies of water, related to the activities of past societies such as navigation, trade, warfare, worldviews, and more. In Mexico, the National Institute of Anthropology and History (INAH), through its Underwater Archaeology Subdirectorate, is responsible for studying, protecting, and conserving this heritage. In the city of San Francisco de Campeche, the INAH has a headquarters where various specialists in archaeology, history, architecture, restoration, and conservation work. In this building, marked with number 223, you can see ancient anchors, cannons, and pottery vessels, among others, under study and conservation.',
images: ['imgPoniente/edificio1.jpg', 'imgPoniente/edificio2.jpg']
},
'Iglesia de San Francisco': {
description: 'The San Francisco neighborhood is one of the oldest and most emblematic neighborhoods in the city of San Francisco de Campeche, with a history dating back to pre-Hispanic times. Originally a Mayan settlement known as Ah Kin Pech, it was later integrated into the village founded by the Spanish in 1540. During the viceroyalty, the neighborhood developed as an extramuros area, that is, outside the city\'s walled perimeter. This location allowed it to maintain an irregular urban layout, with streets and alleys lined with tall colonial mansions, a reflection of its Mayan origins and its evolution during the colonial period. Among the neighborhood\'s notable features are the San Francisco Church and the remains of the convent, which was an important center of evangelization during the viceregal era. In 1653, the ship carrying Don Mart√≠n Cort√©s, son of the conquistador Hern√°n Cort√©s, and his wife arrived in Campeche after being diverted by a storm, and they stayed at the San Francisco convent. His wife gave birth to their first child, who was baptized in the church. You can visit the interior and see the baptismal font commemorating this event. ',
images: ['imgPoniente/sanFrancisco1.jpg', 'imgPoniente/sanFrancisco2.jpg', 'imgPoniente/sanFrancisco3.jpg']
},
'Bateria de San Matias': {
description: 'It is located at the mouth of the old San Francisco estuary, near the neighborhood of the same name. It was built in the 18th century as part of a defense system for the coast and the San Miguel and San Jos√© el Alto redoubts in the port of San Francisco de Campeche, which also included the San Luis and San Lucas batteries. The purpose of the San Mat√≠as battery was to retain any landings on San Francisco beach and prevent the enemy from accessing the San Jos√© el Alto redoubt.',
images: ['imgPoniente/sanMatias1.jpg', 'imgPoniente/sanMatias2.jpg']
},
'Bateria de San Lucas': {
description: 'Its function was to support, together with the San Mat√≠as battery, the defense of the San Jos√© el Alto Redoubt, preventing possible landings towards the windward coast. It was designed by the military engineer Agust√≠n Crame in a semicircular and irregular shape, with an esplanade that had capacity for 8 cannons, a ramp attached to the center and two rooms. Its construction lasted 6 months and was completed in 1792. During periods of high tide, it was usually surrounded by the sea.',
images: ['imgPoniente/sanLucas1.jpg', 'imgPoniente/sanLucas2.jpg', 'imgPoniente/sanLucas3.jpg']
}
}
};

let currentLang = 'es';
const sites = [
  { lat: 19.8379123, lng:-90.5463934, name: 'Barrio de San Rom√°n', image: 'img/sanRoman.jpg' },
      { lat:19.8390079, lng: -90.5497631, name: 'Atarazanas Playa San Rom√°n', image: 'img/atarazanas.png' },
      { lat: 19.8530057, lng: -90.5345565, name: 'Novia del Mar', image: 'img/noviaMar.jpg' },
      { lat: 19.8490853, lng: -90.5309218, name: 'Iglesia de Guadalupe', image: 'img/iglesiaGuadalupe.jpg' },
      { lat:19.848529, lng: -90.5303969, name: 'Edificio INAH Arquiologia Subacuatica', image: 'img/edificioInah.jpg' },
      { lat:19.852794, lng: -90.5245912, name: 'Iglesia de San Francisco', image: 'img/iglesiaSanFrancisco.jpg' },
      { lat:19.8544538, lng: -90.5224778, name: 'Bateria de San Matias', image: 'img/sanMatias.jpg' },
      { lat:19.862693, lng: -90.511714, name: 'Bateria de San Lucas', image: 'img/sanLucas.jpg' }
    ];
// Crear popup SIMPLE para iconos del mapa (solo imagen, t√≠tulo y bot√≥n)
function createSimplePopup(site) {
return `
<div class="simple-popup">
<h3>${site.name}</h3>
<img src="${site.image}" alt="${site.name}">
<button onclick="startRouteToSite('${site.name}', ${site.lat}, ${site.lng})" class="popup-route-btn">
${translations[currentLang].goToRoute}
</button>
</div>
`;
}

// Funci√≥n para iniciar ruta desde popup
function startRouteToSite(siteName, lat, lng) {
if (!userMarker) {
console.log('Ubicaci√≥n del usuario no disponible');
return;
}

// Cancelar cualquier ruta existente autom√°ticamente
if (selectedRouteLine) {
map.removeLayer(selectedRouteLine);
selectedRouteLine = null;
}

if (routeToStartLine) {
map.removeLayer(routeToStartLine);
routeToStartLine = null;
}

if (blueRouteLine) {
map.removeLayer(blueRouteLine);
blueRouteLine = null;
}

// Crear nueva ruta al sitio seleccionado
const site = sites.find(s => s.name === siteName);
if (site) {
selectedSite = site;
drawRouteToSite(lat, lng, siteName);
}

// Cerrar popup
map.closePopup();
}

// Funci√≥n para crear ruta desde el panel lateral
function createRouteFromSidebar(siteName) {
const site = sites.find(s => s.name === siteName);
if (!site) return;

if (!userMarker) {
console.log('Ubicaci√≥n del usuario no disponible');
return;
}

// Cancelar cualquier ruta existente autom√°ticamente
if (selectedRouteLine) {
map.removeLayer(selectedRouteLine);
selectedRouteLine = null;
}

if (routeToStartLine) {
map.removeLayer(routeToStartLine);
routeToStartLine = null;
}

if (blueRouteLine) {
map.removeLayer(blueRouteLine);
blueRouteLine = null;
}

// Crear nueva ruta al sitio seleccionado
selectedSite = site;
drawRouteToSite(site.lat, site.lng, siteName);
}


    const siteIcons = {
      'Barrio de San Rom√°n': L.icon({
        iconUrl: 'iconos/iglesia.png',
        iconSize: [32, 32],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
      }),
      'Atarazanas Playa San Rom√°n': L.icon({
        iconUrl: 'iconos/puerto.png',
        iconSize: [32, 32],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
      }),
      'Novia del Mar': L.icon({
        iconUrl: 'iconos/noviaMar.png',
        iconSize: [32, 32],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
      }),
      'Iglesia de Guadalupe': L.icon({
        iconUrl: 'iconos/iglesia.png',
        iconSize: [32, 32],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
      }),
      'Edificio INAH Arquiologia Subacuatica': L.icon({
        iconUrl: 'iconos/inah.png',
        iconSize: [32, 32],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
      }),
      'Iglesia de San Francisco': L.icon({
        iconUrl: 'iconos/iglesia.png',
        iconSize: [32, 32],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
      }),
      'Bateria de San Matias': L.icon({
        iconUrl: 'iconos/baterias.png',
        iconSize: [32, 32],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
      }),
      'Bateria de San Lucas': L.icon({
        iconUrl: 'iconos/baterias.png',
        iconSize: [32, 32],
        iconAnchor: [16, 32],
        popupAnchor: [0, -32]
      })
    };
    

const markers = [];
sites.forEach(site => {
const marker = L.marker([site.lat, site.lng], { icon: siteIcons[site.name] }).addTo(map);
// Al hacer clic en el marcador, mostrar popup con imagen, t√≠tulo y bot√≥n
marker.bindPopup(createSimplePopup(site));
markers.push({ marker, site });
});

// Actualizar estado de la interfaz seg√∫n rutas activas
function updateRouteUI() {
const routeStatus = document.getElementById('routeStatus');
const routeStatusText = document.getElementById('routeStatusText');
const tourInfo = document.getElementById('tourInfo');
const tourInfoText = document.getElementById('tourInfoText');
const viewRouteBtn = document.getElementById('startRouteBtn');
const goToSiteBtn = document.getElementById('startTourBtn');
const cancelBtn = document.getElementById('cancelRouteBtn');
const clearBtn = document.getElementById('clearAllRoutesBtn');

if (selectedSite && selectedRouteLine) {
// Hay una ruta espec√≠fica a un sitio
routeStatus.classList.add('active');
routeStatusText.textContent = `${translations[currentLang].routeActive}${selectedSite.name}`;
tourInfoText.textContent = `üéØ Ruta espec√≠fica creada hacia: ${selectedSite.name}`;
cancelBtn.style.display = 'inline-block';
clearBtn.style.display = 'inline-block';
activeRouteType = 'selected';
} else if (routeToStartLine) {
// Hay una ruta al sitio m√°s cercano
routeStatus.classList.add('active');
routeStatusText.textContent = translations[currentLang].routeToStart;
tourInfoText.textContent = translations[currentLang].tourInfoToSite;
cancelBtn.style.display = 'inline-block';
clearBtn.style.display = 'inline-block';
activeRouteType = 'start';
} else if (blueRouteLine) {
// Solo hay ruta completa del recorrido
routeStatus.classList.remove('active');
tourInfoText.textContent = translations[currentLang].tourInfoComplete;
clearBtn.style.display = 'inline-block';
cancelBtn.style.display = 'none';
activeRouteType = 'complete';
} else {
// No hay rutas activas
routeStatus.classList.remove('active');
tourInfoText.textContent = translations[currentLang].tourInfoDefault;
cancelBtn.style.display = 'none';
clearBtn.style.display = 'none';
activeRouteType = null;
}

// Actualizar textos de botones
viewRouteBtn.textContent = translations[currentLang].viewCompleteRoute;
goToSiteBtn.textContent = translations[currentLang].goToFirstSite;
cancelBtn.textContent = translations[currentLang].cancelRoute;
clearBtn.textContent = translations[currentLang].clearAll;
}

// Cancelar ruta activa
function cancelActiveRoute() {
if (selectedRouteLine) {
map.removeLayer(selectedRouteLine);
selectedRouteLine = null;
}

if (routeToStartLine) {
map.removeLayer(routeToStartLine);
routeToStartLine = null;
}

selectedSite = null;
localStorage.removeItem('selectedSite');
document.getElementById('distance').innerText = 'Distancia al destino: -';

if (!blueRouteLine) {
getOSRMRoute(sites);
}

updateRouteUI();
}

// Limpiar todas las rutas
function clearAllRoutes() {
if (selectedRouteLine) {
map.removeLayer(selectedRouteLine);
selectedRouteLine = null;
}

if (routeToStartLine) {
map.removeLayer(routeToStartLine);
routeToStartLine = null;
}

if (blueRouteLine) {
map.removeLayer(blueRouteLine);
blueRouteLine = null;
}

selectedSite = null;
localStorage.removeItem('selectedSite');
document.getElementById('distance').innerText = 'Distancia al destino: -';

updateRouteUI();
}

// Abrir panel lateral con informaci√≥n del sitio (SOLO desde botones del men√∫)
function openSidebar(siteName) {
const site = sites.find(s => s.name === siteName);
if (!site) return;
const sidebar = document.getElementById('sidebar');
const sidebarContent = document.getElementById('sidebar-content');
// Detener carrusel anterior si existe
if (carouselInterval) {
clearInterval(carouselInterval);
}
// Calcular distancia si hay ubicaci√≥n del usuario
let distanceInfo = '';
if (userMarker) {
const userPos = userMarker.getLatLng();
const sitePos = L.latLng([site.lat, site.lng]);
const distance = userPos.distanceTo(sitePos);
const distanceText = distance > 1000
? `${(distance / 1000).toFixed(2)} ${translations[currentLang].kilometers}`
: `${Math.round(distance)} ${translations[currentLang].meters}`;
distanceInfo = `
<div class="distance-info">
<span class="distance-label">${translations[currentLang].distance}:</span>
<span class="distance-value">${distanceText}</span>
</div>
`;
}
const siteData = translations[currentLang][siteName];
const images = siteData.images || [site.image];
sidebarContent.innerHTML = `
<div class="sidebar-header">
<div class="header-content">
<h2>${siteName}</h2>
${distanceInfo}
</div>
<button onclick="closeSidebar()" class="close-btn">
‚úï ${translations[currentLang].closeSidebar}
</button>
</div>
<div class="image-carousel">
<div class="carousel-container">
<div class="carousel-images" id="carousel-images">
${images.map((img, index) => `
<img src="${img}" alt="${siteName}"
class="carousel-image ${index === 0 ? 'active' : ''}"
data-index="${index}"
onerror="this.src='${site.image}'">
`).join('')}
</div>
${images.length > 1 ? `
<div class="carousel-controls">
<button onclick="prevImage()" class="carousel-btn prev-btn">
‚ùÆ ${translations[currentLang].prevImage}
</button>
<div class="carousel-indicators">
${images.map((_, index) => `
<span class="indicator ${index === 0 ? 'active' : ''}"
onclick="goToImage(${index})" data-index="${index}"></span>
`).join('')}
</div>
<button onclick="nextImage()" class="carousel-btn next-btn">
${translations[currentLang].nextImage} ‚ùØ
</button>
</div>
<div class="carousel-progress">
<div class="progress-bar" id="progress-bar"></div>
</div>
` : ''}
</div>
</div>
<div class="site-description">
<p>${siteData.description}</p>
<div class="action-buttons">
<button onclick="speakDescription('${siteData.description.replace(/'/g, "\\'")}', '${siteName.replace(/'/g, "\\'")}'); return false;" class="speak-btn">
üîä ${translations[currentLang].listenDescription}
</button>

<button onclick="toggleSpeech();" id="pauseBtn" class="speak-btn" style="display: none;">
  ‚è∏Ô∏è Pausar
</button>

<button onclick="centerMapOnSite(${site.lat}, ${site.lng})" class="center-btn">
üéØ ${translations[currentLang].centerMap}
</button>
<button onclick="createRouteFromSidebar('${siteName}')" class="route-btn">
üöó ${translations[currentLang].createRoute}
</button>
</div>
</div>
`;
// Mostrar sidebar
sidebar.classList.add('active');

// Hacer scroll hacia el mapa en dispositivos m√≥viles
scrollToMapOnMobile();

// Inicializar carrusel autom√°tico solo si hay m√∫ltiples im√°genes
if (images.length > 1) {
currentCarouselIndex = 0;
startCarousel(images.length);
updateProgressBar();
}
}

// Cerrar panel lateral
function closeSidebar() {
  const sidebar = document.getElementById('sidebar');
  sidebar.classList.remove('active');

  // Detener carrusel
  if (carouselInterval) {
    clearInterval(carouselInterval);
  }

  // Pausar la voz en lugar de cancelar
  if ('speechSynthesis' in window) {
    if (speechSynthesis.speaking && !speechSynthesis.paused) {
      speechSynthesis.pause();
      isPaused = true;
      const pauseBtn = document.getElementById('pauseBtn');
      if (pauseBtn) pauseBtn.innerText = '‚ñ∂Ô∏è Reanudar';
    }
  }
}



// Iniciar carrusel autom√°tico
function startCarousel(totalImages) {
updateProgressBar();
carouselInterval = setInterval(() => {
nextImage(totalImages);
updateProgressBar();
}, 4000);
}

// Actualizar barra de progreso del carrusel
function updateProgressBar() {
const progressBar = document.getElementById('progress-bar');
if (progressBar) {
progressBar.style.width = '0%';
progressBar.style.transition = 'width 4s linear';
setTimeout(() => {
progressBar.style.width = '100%';
}, 50);
}
}

// Navegar a imagen anterior
function prevImage() {
const images = document.querySelectorAll('.carousel-image');
const indicators = document.querySelectorAll('.indicator');
if (images.length === 0) return;
images[currentCarouselIndex].classList.remove('active');
if (indicators[currentCarouselIndex]) indicators[currentCarouselIndex].classList.remove('active');
currentCarouselIndex = currentCarouselIndex === 0 ? images.length - 1 : currentCarouselIndex - 1;
images[currentCarouselIndex].classList.add('active');
if (indicators[currentCarouselIndex]) indicators[currentCarouselIndex].classList.add('active');
// Reiniciar carrusel autom√°tico
if (carouselInterval) {
clearInterval(carouselInterval);
startCarousel(images.length);
}
}

// Navegar a imagen siguiente
function nextImage(totalImages = null) {
const images = document.querySelectorAll('.carousel-image');
const indicators = document.querySelectorAll('.indicator');
if (images.length === 0) return;
const total = totalImages || images.length;
images[currentCarouselIndex].classList.remove('active');
if (indicators[currentCarouselIndex]) indicators[currentCarouselIndex].classList.remove('active');
currentCarouselIndex = (currentCarouselIndex + 1) % total;
images[currentCarouselIndex].classList.add('active');
if (indicators[currentCarouselIndex]) indicators[currentCarouselIndex].classList.add('active');
}

// Ir a imagen espec√≠fica
function goToImage(index) {
const images = document.querySelectorAll('.carousel-image');
const indicators = document.querySelectorAll('.indicator');
if (images.length === 0) return;
images[currentCarouselIndex].classList.remove('active');
if (indicators[currentCarouselIndex]) indicators[currentCarouselIndex].classList.remove('active');
currentCarouselIndex = index;
images[currentCarouselIndex].classList.add('active');
if (indicators[currentCarouselIndex]) indicators[currentCarouselIndex].classList.add('active');
// Reiniciar carrusel autom√°tico
if (carouselInterval) {
clearInterval(carouselInterval);
startCarousel(images.length);
}
}

let isPaused = false;

function speakDescription(text, title) {
  if ('speechSynthesis' in window) {
    speechSynthesis.cancel(); // detener cualquier lectura anterior

    const fullText = `${title}. ${text}`;
    const utterance = new SpeechSynthesisUtterance(fullText);
    utterance.lang = currentLang === 'es' ? 'es-MX' : 'en-US';
    utterance.rate = 0.8;

    const speakBtn = document.querySelector('.speak-btn');
    const pauseBtn = document.getElementById('pauseBtn');

    if (speakBtn) {
      const originalText = speakBtn.innerHTML;
      speakBtn.innerHTML = '‚è∏Ô∏è Reproduciendo...';
      speakBtn.disabled = true;
      if (pauseBtn) {
        pauseBtn.style.display = 'inline-block';
        pauseBtn.innerText = '‚è∏Ô∏è Pausar';
        isPaused = false;
      }

      utterance.onend = () => {
        speakBtn.innerHTML = originalText;
        speakBtn.disabled = false;
        if (pauseBtn) {
          pauseBtn.style.display = 'none';
        }
        isPaused = false;
      };

      utterance.onerror = () => {
        speakBtn.innerHTML = originalText;
        speakBtn.disabled = false;
        if (pauseBtn) {
          pauseBtn.style.display = 'none';
        }
        isPaused = false;
      };
    }

    speechSynthesis.speak(utterance);
  }
}


function toggleSpeech() {
  const pauseBtn = document.getElementById('pauseBtn');
  if ('speechSynthesis' in window && speechSynthesis.speaking) {
    if (isPaused) {
      speechSynthesis.resume();
      pauseBtn.innerText = '‚è∏Ô∏è Pausar';
      isPaused = false;
    } else {
      speechSynthesis.pause();
      pauseBtn.innerText = '‚ñ∂Ô∏è Reanudar';
      isPaused = true;
    }
  }
}







// Centrar mapa en sitio espec√≠fico
function centerMapOnSite(lat, lng) {
map.setView([lat, lng], 16);
closeSidebar();
}

// Geolocalizaci√≥n
if (navigator.geolocation) {
navigator.geolocation.watchPosition(onLocationFound, onLocationError, {
enableHighAccuracy: true,
timeout: 10000,
maximumAge: 0
});
} else {
console.log('La geolocalizaci√≥n no est√° disponible en este dispositivo.');
}

function onLocationFound(position) {
const userLocation = L.latLng(position.coords.latitude, position.coords.longitude);
if (!userMarker) {
userMarker = L.marker(userLocation).addTo(map).bindPopup('Tu ubicaci√≥n').openPopup();
} else {
userMarker.setLatLng(userLocation);
}
if (followUser) {
map.setView(userLocation, 15);
}
if (selectedSite) {
drawRouteToSite(selectedSite.lat, selectedSite.lng, selectedSite.name);
}
}

function onLocationError(e) {
console.error('Error de geolocalizaci√≥n:', e.message);
}

// Funciones de rutas (manteniendo la funcionalidad original)
function getOSRMRoute(sites) {
const coordinates = sites.map(site => `${site.lng},${site.lat}`).join(';');
const url = `https://router.project-osrm.org/route/v1/driving/${coordinates}?overview=full&geometries=geojson`;
fetch(url)
.then(res => res.json())
.then(data => {
const coords = data.routes[0].geometry.coordinates.map(c => [c[1], c[0]]);
if (blueRouteLine) {
map.removeLayer(blueRouteLine);
}
blueRouteLine = L.polyline(coords, { color: 'blue', weight: 4 }).addTo(map);
updateRouteUI();
})
.catch(err => console.error('Error al trazar ruta:', err));
}

function drawRouteToSite(destLat, destLng, siteName) {
if (!userMarker) {
console.log('Ubicaci√≥n del usuario no disponible.');
return;
}
const userLocation = userMarker.getLatLng();
const start = `${userLocation.lng},${userLocation.lat}`;
const end = `${destLng},${destLat}`;
const url = `https://router.project-osrm.org/route/v1/driving/${start};${end}?overview=full&geometries=geojson`;
if (blueRouteLine) {
map.removeLayer(blueRouteLine);
blueRouteLine = null;
}
fetch(url)
.then(res => res.json())
.then(data => {
const coords = data.routes[0].geometry.coordinates.map(c => [c[1], c[0]]);
if (selectedRouteLine) map.removeLayer(selectedRouteLine);
selectedRouteLine = L.polyline(coords, {
color: 'red',
weight: 5
}).addTo(map);
map.fitBounds(selectedRouteLine.getBounds());
const dist = (userLocation.distanceTo([destLat, destLng]) / 1000).toFixed(2);
document.getElementById('distance').innerText = `${translations[currentLang].distance}: ${dist} km`;
selectedSite = { lat: destLat, lng: destLng, name: siteName };
localStorage.setItem('selectedSite', JSON.stringify(selectedSite));
updateRouteUI();
})
.catch(err => {
console.error('Error al trazar ruta:', err);
});
}

// Crear men√∫ de sitios - SOLO ABRE EL PANEL LATERAL (sin afectar el mapa)
function createSiteMenu() {
const container = document.getElementById('siteButtons');
container.innerHTML = '';
sites.forEach((site, index) => {
const btn = document.createElement('button');
btn.className = 'btn-red-vino';
btn.innerText = site.name;
btn.onclick = () => {
// SOLO abrir panel lateral (SIN centrar mapa, SIN mostrar popup, SIN crear ruta)
openSidebar(site.name);
};
container.appendChild(btn);
});
}

// Cambio de idioma
document.getElementById('btnEs').addEventListener('click', () => {
currentLang = 'es';
updateUI();
});
document.getElementById('btnEn').addEventListener('click', () => {
currentLang = 'en';
updateUI();
});

// Event listeners para botones de control de rutas
document.getElementById('cancelRouteBtn').addEventListener('click', cancelActiveRoute);
document.getElementById('clearAllRoutesBtn').addEventListener('click', clearAllRoutes);

function updateUI() {
document.querySelector('#description p').innerText = translations[currentLang].welcome;
// Actualizar popups simples de los marcadores
markers.forEach(({ marker, site }) => {
marker.setPopupContent(createSimplePopup(site));
});
closeSidebar();
updateRouteUI();
}

// Bot√≥n ver recorrido completo
document.getElementById('startRouteBtn').addEventListener('click', () => {
// Limpiar rutas espec√≠ficas si existen
if (selectedRouteLine) {
map.removeLayer(selectedRouteLine);
selectedRouteLine = null;
}
if (routeToStartLine) {
map.removeLayer(routeToStartLine);
routeToStartLine = null;
}
selectedSite = null;
localStorage.removeItem('selectedSite');
document.getElementById('distance').innerText = 'Distancia al destino: -';

// Mostrar ruta completa
if (!blueRouteLine) {
getOSRMRoute(sites);
} else {
// Si ya existe, ajustar vista del mapa
map.fitBounds(blueRouteLine.getBounds());
}
updateRouteUI();
});

// Bot√≥n ir al primer sitio (sitio m√°s cercano)
document.getElementById('startTourBtn').addEventListener('click', () => {
if (!userMarker) {
console.log('Ubicaci√≥n del usuario no disponible.');
return;
}

const userLocation = userMarker.getLatLng();
const nearest = sites.reduce((a, b) => {
const d1 = userLocation.distanceTo([a.lat, a.lng]);
const d2 = userLocation.distanceTo([b.lat, b.lng]);
return d1 < d2 ? a : b;
});

const start = `${userLocation.lng},${userLocation.lat}`;
const end = `${nearest.lng},${nearest.lat}`;
const url = `https://router.project-osrm.org/route/v1/driving/${start};${end}?overview=full&geometries=geojson`;

// Limpiar ruta azul si existe
if (blueRouteLine) {
map.removeLayer(blueRouteLine);
blueRouteLine = null;
}

fetch(url)
.then(res => res.json())
.then(data => {
const coords = data.routes[0].geometry.coordinates.map(c => [c[1], c[0]]);
if (routeToStartLine) map.removeLayer(routeToStartLine);
routeToStartLine = L.polyline(coords, {
color: 'green',
weight: 5,
dashArray: '10,5'
}).addTo(map);
map.fitBounds(routeToStartLine.getBounds());

// Mostrar informaci√≥n del sitio m√°s cercano
const dist = (userLocation.distanceTo([nearest.lat, nearest.lng]) / 1000).toFixed(2);
document.getElementById('distance').innerText = `${translations[currentLang].distance}: ${dist} km`;

updateRouteUI();
})
.catch(err => {
console.error('Error al trazar ruta:', err);
});
});

// Al cargar la p√°gina
window.addEventListener('load', () => {
const saved = localStorage.getItem('selectedSite');
if (saved) {
const site = JSON.parse(saved);
selectedSite = site;
drawRouteToSite(site.lat, site.lng, site.name);
}
});

// Inicializar
getOSRMRoute(sites);
createSiteMenu();

// Limpiar recursos al cerrar
window.addEventListener('beforeunload', function() {
if (carouselInterval) {
clearInterval(carouselInterval);
}
if ('speechSynthesis' in window) {
speechSynthesis.cancel();
}
});

// Manejar cambios de visibilidad de la p√°gina
document.addEventListener('visibilitychange', function() {
if (document.hidden) {
if (carouselInterval) {
clearInterval(carouselInterval);
}
} else {
const images = document.querySelectorAll('.carousel-image');
if (images.length > 1) {
startCarousel(images.length);
}
}
});
</script>
</body>
</html>